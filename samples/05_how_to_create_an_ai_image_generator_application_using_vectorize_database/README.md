# 05 Creating an AI Image Generator Application Using Vectorized Database (Demo)

This repository contains a demo application for stability-byom-docker-image.

## Pinecone

[Pinecone](https://www.pinecone.io/) is a powerful vector database that enables efficient storage and retrieval of high-dimensional vector embeddings. In this section, we will learn how to create an index on Pinecone and utilize that index in our application.

To create an index on Pinecone, follow these steps:

1. Sign in to the Pinecone Console at [https://www.pinecone.io/](https://www.pinecone.io/) using your account credentials.

2. Create a new Pinecone index.

3. Once the index is created, you can insert the pinecone api_key in `app.py`.

Refer to the Pinecone documentation and resources for detailed instructions on how to create and work with indexes.

## Installation

Follow these steps to install the necessary dependencies and configure the application:

1. Install the required Python dependencies by running the following command:
   ```bash
   pip install -r requirements.txt
   ```

2. Create an S3 bucket in your desired region and modify `app.py` to point to the correct S3 bucket. In our example, we have set the default bucket as `stable-diffusion-2-1-demo`:
   ```python
   S3_BUCKET = "stable-diffusion-2-1-demo"
   ```

3. In `app.py`, update the following configurations to match your Pinecone setup:
   ```python
   PINECONE_API_KEY = "xxxxxx-xxxxx-xxxx-xxxxx-xxxxx"
   PINECONE_ENVIRONMENT = "us-west4-gcp-free"
   PINECONE_INDEX_NAME = "dream-cacher"
   ```

Make sure to replace the placeholders (`xxxxxx-xxxxx-xxxx-xxxxx-xxxxx`, `us-west4-gcp-free`, `dream-cacher`) with your actual Pinecone API key, environment, and index name, respectively.

## Deploying the Model

To deploy the stability model, please follow these steps after assuming that you have already built and deployed your model, resulting in a SageMaker endpoint configuration and image location. Make the necessary changes to the `deploy.py` file based on the information provided below. If you require assistance with this process, you can refer back to the [Deploy stable diffusion notebook](../02_deploy_stable_diffusion2_1_with_custom_image_and_custom_script/deploy-stable-diffusion-2-1.ipynb). Once the deployment is complete, you can find the endpoint configuration in the SageMaker console.

```python
endpoint_config_name = 'xxxxxxxx'  # Replace 'xxxxxxxx' with the actual endpoint config name from the SageMaker console.
endpoint_name = name_from_base('stable-diffusion-model-triumph-demo')

sagemaker_client = boto3.client('sagemaker')
response = sagemaker_client.create_endpoint(
    EndpointName=endpoint_name,
    EndpointConfigName=endpoint_config_name,
)
```

To deploy the stability model, follow these steps:

1. Run the deployment script:
   ```bash
   sh deploy_model.sh
   ```

2. Wait for approximately 7-8 minutes until the endpoint is live.

## Running the Application

To run the stability-byom-docker-image application, follow these steps:

1. Run the application script and specify the endpoint name. (give the endpoint name as param)
   ```bash
   sh run_app.sh stable-diffusion-model-demo-2023-05-25-13-17-42-499
   ```

2. Open your browser and navigate to the application.

3. Provide a session ID to interact with the model.

## Deploying and Running Together

Alternatively, you can use the convenience script to deploy the model and run the application in one step. This script handles both deployment and application startup.
```bash
sh deploy_run_app.sh
```

Please note that the deployment process may take a few minutes for the model to be deployed (so if you'll see errors then the model is not yet created).

Enjoy!

## Example Images

Here are a few example images from the demo:

![Example Image 1](placeholder_image1.jpg)

![Example Image 2](placeholder_image2.jpg)

![Example Image 3](placeholder_image3.jpg)

These images provide a glimpse of the visual output and results that can be generated by the demo application.